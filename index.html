<!DOCTYPE html>
<html>
<head>
    <title>Grand Event Duck Race</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #1a1a1a; color: white; text-align: center; margin: 0; }
        .setup-screen { background: #2c3e50; padding: 20px; border-bottom: 5px solid #f1c40f; }
        canvas { background: #2980b9; display: block; margin: 20px auto; border-radius: 8px; box-shadow: 0 0 50px rgba(0,0,0,0.8); cursor: crosshair; }
        .ui-panel { display: flex; justify-content: center; gap: 20px; align-items: center; flex-wrap: wrap; }
        textarea { width: 300px; height: 50px; border-radius: 5px; padding: 10px; }
        .timer-setting { font-weight: bold; color: #f1c40f; }
        button { background: #27ae60; color: white; border: none; padding: 15px 40px; font-size: 20px; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px #1e8449; }
        button:active { box-shadow: 0 0; transform: translateY(4px); }
        #announcer { font-size: 28px; color: #f1c40f; margin: 10px; height: 40px; text-transform: uppercase; font-weight: bold; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="setup-screen" id="setup">
    <h1>ü¶Ü EVENT DUCK RACE üèÅ</h1>
    <div class="ui-panel">
        <div>
            <label>Friends (Names):</label><br>
            <textarea id="nameInput">Alex, Jordan, Taylor, Sam, Quinn, Casey</textarea>
        </div>
        <div>
            <label>Race Duration: <span class="timer-setting" id="timeVal">20</span>s</label><br>
            <input type="range" id="durationInput" min="10" max="60" value="20" oninput="document.getElementById('timeVal').innerText=this.value">
        </div>
        <button onclick="startEvent()">START THE EVENT</button>
    </div>
</div>

<div id="announcer">Waiting for the line-up...</div>
<canvas id="raceCanvas" width="1000" height="500"></canvas>

<script>
    const canvas = document.getElementById('raceCanvas');
    const ctx = canvas.getContext('2d');
    const announcer = document.getElementById('announcer');
    
    let ducks = [];
    let racing = false;
    let startTime;
    let raceDuration; // in milliseconds
    let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // Procedural Quack Sound (No files needed!)
    function playQuack() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    function startEvent() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        
        const names = document.getElementById('nameInput').value.split(/[, \n]+/).filter(n => n.trim() !== "");
        raceDuration = document.getElementById('durationInput').value * 1000;
        
        ducks = names.map((name, i) => ({
            name: name,
            x: 50,
            y: 80 + (i * (380 / names.length)),
            color: `hsl(${Math.random() * 360}, 80%, 60%)`,
            offset: Math.random() * 1000, // For unique pathing
            finished: false,
            rank: 0
        }));

        startTime = Date.now();
        racing = true;
        announcer.innerText = "READY... SET... QUACK!";
        playQuack();
        animate();
    }

    function animate() {
        if (!racing) return;

        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / raceDuration, 1);
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Water Ripples
        ctx.strokeStyle = "rgba(255,255,255,0.1)";
        for(let i=0; i<5; i++) {
            let rx = (elapsed * 0.1 + (i * 200)) % 1000;
            ctx.beginPath(); ctx.moveTo(rx, 0); ctx.lineTo(rx-50, 500); ctx.stroke();
        }

        // Draw Finish Line
        ctx.fillStyle = "#f1c40f";
        ctx.fillRect(920, 0, 10, 500);

        ducks.forEach(duck => {
            if (!duck.finished) {
                // Suspense Physics: Each duck follows a sine wave but stays close to the average progress
                // We add random "wobble" to the progress so they overtake each other
                let duckProgress = progress + (Math.sin(elapsed/500 + duck.offset) * 0.05);
                
                // Sudden Boost Logic
                if(Math.random() > 0.995) {
                    duckProgress += 0.08; 
                    playQuack();
                }

                duck.x = 50 + (870 * Math.max(0, duckProgress));
                
                if (duck.x >= 920) {
                    duck.finished = true;
                    duck.rank = ducks.filter(d => d.finished).length;
                    if(duck.rank === 1) {
                        announcer.innerText = `üèÜ ${duck.name} TAKES THE LEAD! üèÜ`;
                        playQuack(); setTimeout(playQuack, 150);
                    }
                }
            }

            // Draw Duck
            ctx.save();
            let wobble = Math.sin(elapsed/150 + duck.offset) * 5;
            ctx.translate(duck.x, duck.y + wobble);
            
            // Body
            ctx.fillStyle = duck.color;
            ctx.beginPath(); ctx.ellipse(0, 0, 20, 15, 0, 0, Math.PI*2); ctx.fill();
            // Head
            ctx.beginPath(); ctx.arc(15, -12, 10, 0, Math.PI*2); ctx.fill();
            // Beak
            ctx.fillStyle = "orange";
            ctx.beginPath(); ctx.moveTo(22, -12); ctx.lineTo(32, -10); ctx.lineTo(22, -8); ctx.fill();
            // Name
            ctx.fillStyle = "white";
            ctx.font = "bold 16px Arial";
            ctx.textAlign = "center";
            ctx.fillText(duck.name, 0, -30);
            
            ctx.restore();
        });

        if (ducks.every(d => d.finished)) {
            const winner = ducks.find(d => d.rank === 1);
            announcer.innerText = `üéâ CHAMPION: ${winner.name}! üéâ`;
            racing = false;
        } else {
            requestAnimationFrame(animate);
        }
    }
</script>
</body>
</html>

